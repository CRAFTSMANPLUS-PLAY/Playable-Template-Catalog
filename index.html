// CRAFTSMAN+ PLAY Catalogue Viewer (Public Snapshot)
// -------------------------------------------------
// This is the read-only / shareable catalogue.
// - Dark page background
// - White cards
// - 4-wide grid
// - Sections: PLAYABLES then ANIMATED BANNERS
// - Within each section: group by Genre ("Gaming", "Automotive", etc.)
// - Each card embeds the *Endpoint URL* in an <iframe>
// - If Complex / Advanced Option is true, we show a badge:
//     "Advanced Options / Variants Available"
// - We hide "Best for" for now (will enable once that data exists)
// - We'll brand as CRAFTSMAN+ PLAY by default, but we’ll keep the top branding
//   configurable so you can clone this file for Remerge later.
//
// HOW TO USE THIS FILE
// 1. Convert your Google Sheet -> JSON rows shaped like:
//    {
//      title: string,
//      genre: string,
//      endpointUrl: string,  // <-- this is what goes in the iframe src
//      isBanner: boolean,    // true if Column F == "Banner"
//      hasAdvanced: boolean, // true if Column E is TRUE / checked
//    }
// 2. Paste that array into RAW_ITEMS below.
// 3. Deploy this component.
// 4. Send link.
//
// NOTE: "Best for" is intentionally omitted from render for now.
// -------------------------------------------------

// BRANDING CONFIG ---------------------------------
const BRAND_LOGO_TEXT = "CRAFTSMAN+"; // for now just text. For Remerge version, swap to their logo img.
const BRAND_TITLE = "CRAFTSMAN+ PLAY Catalogue";
const BRAND_SUBTITLE = "Interactive Ad Concepts & Variants";
const BRAND_TAGLINE = "Powered by CRAFTSMAN+ PLAY"; // keep this always visible to make attribution clear.

// DATA SNAPSHOT -----------------------------------
// TODO: Replace RAW_ITEMS with data you generate from the sheet.
// Example stub (this is placeholder so you can see structure):
const RAW_ITEMS = [
  {
    title: "Swipe-to-Throw",
    genre: "Gaming",
    endpointUrl:
      "https://endpoints.prod.craftsmanplus.com/previews/demo1/index.html",
    isBanner: false,
    hasAdvanced: true,
  },
  {
    title: "Dress-Up Avatar",
    genre: "Gaming",
    endpointUrl:
      "https://endpoints.prod.craftsmanplus.com/previews/demo2/index.html",
    isBanner: false,
    hasAdvanced: false,
  },
  {
    title: "Holiday Offer CTA",
    genre: "Holiday",
    endpointUrl:
      "https://endpoints.prod.craftsmanplus.com/previews/bannerA/index.html",
    isBanner: true,
    hasAdvanced: true,
  },
];

// -------------------------------------------------
// Helpers to group and split content
function groupByGenre(items) {
  const map = {};
  for (const it of items) {
    const genre = it.genre && it.genre.trim() ? it.genre.trim() : "Other";
    if (!map[genre]) map[genre] = [];
    map[genre].push(it);
  }
  return map; // { "Gaming": [..], "Holiday": [..] }
}

function SectionHeader({ label }) {
  return (
    <div className="flex flex-col md:flex-row md:items-end md:justify-between gap-3 mb-6">
      <div className="flex-1">
        <div className="text-sm font-semibold text-white leading-tight">{label}</div>
      </div>
      <div className="text-[10px] text-white/40">CRAFTSMAN+ PLAY</div>
    </div>
  );
}

function GenreHeader({ genre, count }) {
  return (
    <div className="flex items-baseline justify-between mb-3">
      <div className="text-xs font-semibold text-white/90">{genre}</div>
      <div className="text-[10px] text-white/40">{count} demos</div>
    </div>
  );
}

// Single Card ---------------------------------------------------------------
function CatalogueCard({ item, onExpand }) {
  return (
    <div className="bg-white rounded-2xl shadow-sm border border-black/10 overflow-hidden flex flex-col">
      {/* Card header info */}
      <div className="px-3 py-3 border-b border-black/10 flex flex-col gap-2">
        <div className="flex items-start justify-between gap-2">
          <div className="min-w-0">
            {/* Title */}
            <div className="text-[13px] font-medium text-black leading-tight truncate">
              {item.title || "Untitled"}
            </div>

            {/* Genre */}
            <div className="text-[11px] text-black/60 leading-tight truncate">
              {item.genre && item.genre.trim() ? item.genre : "Other"}
            </div>

            {/* Advanced badge */}
            {item.hasAdvanced ? (
              <div className="inline-flex items-center gap-1 text-[10px] font-medium text-emerald-700 bg-emerald-50 border border-emerald-200 rounded-lg px-2 py-1 mt-2">
                <span className="text-[10px]">✔</span>
                <span>Advanced Options / Variants Available</span>
              </div>
            ) : null}

            {/* Best for: (hidden for now unless we add data later) */}
            {/* We'll add conditional render later when we have item.bestFor */}
          </div>

          {/* Action buttons */}
          <div className="flex items-center gap-2 text-[11px] text-black/50">
            <button
              onClick={() => window.open(item.endpointUrl, "_blank")}
              className="p-1.5 rounded-lg hover:bg-black/10 active:scale-95 transition"
              title="Open full experience in new tab"
            >
              ↗️
            </button>
            <button
              onClick={onExpand}
              className="p-1.5 rounded-lg hover:bg-black/10 active:scale-95 transition"
              title="Expand preview"
            >
              ⛶
            </button>
          </div>
        </div>
      </div>

      {/* Iframe preview */}
      <div className="w-full" style={{ height: 260 }}>
        <iframe
          title={item.title || "Preview"}
          src={item.endpointUrl}
          className="w-full h-full"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture;"
          loading="lazy"
        />
      </div>

      {/* Footer row */}
      <div className="px-3 py-2 border-t border-black/10 text-[10px] text-black/50 truncate">
        {item.endpointUrl}
      </div>
    </div>
  );
}

// Fullscreen modal ---------------------------------------------------------
function Modal({ open, onClose, url, title }) {
  if (!open) return null;
  return (
    <div className="fixed inset-0 z-50">
      <div
        className="absolute inset-0 bg-black/60 backdrop-blur-sm"
        onClick={onClose}
      />
      <div className="absolute inset-4 md:inset-10 rounded-2xl bg-white shadow-2xl overflow-hidden flex flex-col">
        <div className="flex items-center justify-between p-3 border-b border-black/10">
          <div className="text-sm font-medium text-black/70 truncate pr-4">{title || "Preview"}</div>
          <button
            onClick={onClose}
            className="px-3 py-2 rounded-xl shadow-sm border border-black/10 bg-white hover:bg-black/5 active:scale-[.99] transition text-sm"
          >
            Close
          </button>
        </div>
        <div className="flex-1 overflow-hidden bg-black/5">
          <iframe
            title={title}
            src={url}
            className="w-full h-full"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture;"
          />
        </div>
      </div>
    </div>
  );
}

// Main Viewer --------------------------------------------------------------
export default function PlayCatalogueViewer() {
  // Split raw items into Playables vs Banners
  const playables = RAW_ITEMS.filter((it) => !it.isBanner);
  const banners = RAW_ITEMS.filter((it) => it.isBanner);

  // Then group each side by genre
  const playableByGenre = groupByGenre(playables);
  const bannerByGenre = groupByGenre(banners);

  // Modal state
  const [modal, setModal] = React.useState({ open: false, url: "", title: "" });
  const openModal = (url, title) => setModal({ open: true, url, title });
  const closeModal = () => setModal({ open: false, url: "", title: "" });

  return (
    <div className="min-h-screen bg-[#0f0f10] text-white">
      {/* HEADER / BRANDING ------------------------------------------------ */}
      <header className="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-[#0f0f10]/60 bg-[#0f0f10]/80 border-b border-white/10">
        <div className="max-w-7xl mx-auto px-4 py-4 flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
          <div className="flex items-start gap-3">
            <div className="w-10 h-10 rounded-2xl bg-white text-black grid place-items-center text-[10px] font-semibold shadow-md">
              {BRAND_LOGO_TEXT}
            </div>
            <div className="min-w-0">
              <div className="text-sm font-semibold text-white leading-tight">{BRAND_TITLE}</div>
              <div className="text-[11px] text-white/60 leading-tight">{BRAND_SUBTITLE}</div>
              <div className="text-[10px] text-white/40 leading-tight">{BRAND_TAGLINE}</div>
            </div>
          </div>
          <div className="text-[10px] text-white/40 leading-tight sm:text-right">
            Read-only snapshot<br />No login required
          </div>
        </div>
      </header>

      {/* BODY -------------------------------------------------------------- */}
      <main className="max-w-7xl mx-auto px-4 py-8">
        {/* PLAYABLES SECTION */}
        {playables.length > 0 && (
          <section className="mb-14">
            <SectionHeader label="PLAYABLES" />

            {Object.entries(playableByGenre).map(([genre, list]) => (
              <div key={genre} className="mb-10">
                <GenreHeader genre={genre} count={list.length} />

                <div
                  className="grid gap-4"
                  style={{ gridTemplateColumns: `repeat(4, minmax(0, 1fr))` }}
                >
                  {list.map((item, i) => (
                    <CatalogueCard
                      key={genre + "-p-" + i}
                      item={item}
                      onExpand={() => openModal(item.endpointUrl, item.title)}
                    />
                  ))}
                </div>
              </div>
            ))}
          </section>
        )}

        {/* ANIMATED BANNERS SECTION */}
        {banners.length > 0 && (
          <section className="mb-14">
            <SectionHeader label="ANIMATED BANNERS" />

            {Object.entries(bannerByGenre).map(([genre, list]) => (
              <div key={genre} className="mb-10">
                <GenreHeader genre={genre} count={list.length} />

                <div
                  className="grid gap-4"
                  style={{ gridTemplateColumns: `repeat(4, minmax(0, 1fr))` }}
                >
                  {list.map((item, i) => (
                    <CatalogueCard
                      key={genre + "-b-" + i}
                      item={item}
                      onExpand={() => openModal(item.endpointUrl, item.title)}
                    />
                  ))}
                </div>
              </div>
            ))}
          </section>
        )}
      </main>

      {/* MODAL ------------------------------------------------------------ */}
      <Modal
        open={modal.open}
        onClose={closeModal}
        url={modal.url}
        title={modal.title}
      />

      {/* FOOTER ----------------------------------------------------------- */}
      <footer className="max-w-7xl mx-auto px-4 pb-12 text-center text-[10px] text-white/40">
        CRAFTSMAN+ PLAY snapshot. Embeds shown here must allow iframe embedding. Some internal or restricted URLs may not render.
      </footer>
    </div>
  );
}
