<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CRAFTSMAN+ • Template Catalog</title>
  <style>
    :root {
      --bg: #0f1530;
      --surface: rgba(10, 13, 25, 0.2);
      --card: rgba(9, 11, 25, 0.35);
      --text: #ffffff;
      --muted: rgba(255, 255, 255, 0.5);
      --accent: #3d7fff;
      --radius-lg: 1.4rem;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(circle at top, #17234f 0, #0f1530 40%, #0a0d19 100%);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Inter", system-ui, sans-serif;
      min-height: 100vh;
      display: flex;
      gap: 1.5rem;
      padding: 1.5rem;
    }
    .wrap {
      flex: 1 1 auto;
      max-width: 1200px;
    }
    header {
      margin-bottom: 1.75rem;
    }
    h1 {
      font-size: 1.3rem;
      margin: 0;
      letter-spacing: .04em;
    }
    .subtitle {
      color: var(--muted);
      font-size: .75rem;
      margin-top: .25rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 1.1rem;
    }
    .card {
      background: radial-gradient(circle at top, rgba(13, 24, 43, 0.6), rgba(6, 8, 15, 0.35));
      border: 1px solid rgba(255,255,255,.04);
      border-radius: 1.1rem;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 280px;
      backdrop-filter: blur(8px);
      position: relative;
    }
    .thumb {
      background: radial-gradient(circle, rgba(15,21,41,.5), rgba(5,6,10,.4));
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255,255,255,.3);
      font-size: .7rem;
      position: relative;
    }
    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .card-body {
      padding: .9rem .9rem 1rem;
      display: flex;
      flex-direction: column;
      gap: .5rem;
      flex: 1 1 auto;
    }
    .title-row {
      display: flex;
      justify-content: space-between;
      gap: .5rem;
      align-items: flex-start;
    }
    .card-title {
      font-size: .85rem;
      font-weight: 600;
      line-height: 1.3;
    }
    .external-btn {
      width: 26px;
      height: 26px;
      border: 1px solid rgba(255,255,255,.18);
      border-radius: .7rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(1,1,1,.15);
      cursor: pointer;
    }
    .genre-pill {
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.04);
      border-radius: 999px;
      padding: .22rem .75rem;
      font-size: .65rem;
      color: rgba(255,255,255,.55);
      width: fit-content;
    }
    .play-row {
      margin-top: auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: .5rem;
    }
    .play-btn {
      border: none;
      background: #ffffff;
      color: #020617;
      border-radius: 999px;
      padding: .45rem .85rem;
      font-size: .7rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: .4rem;
      cursor: pointer;
    }
    .play-btn:disabled {
      background: rgba(255,255,255,.15);
      color: rgba(255,255,255,.5);
      cursor: not-allowed;
    }
    .right-pane {
      width: 350px;
      background: radial-gradient(circle at 0 0, rgba(140, 42, 19, .6), rgba(2,4,9,1));
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 1.5rem;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .preview-header {
      padding: 1.1rem 1.15rem .3rem;
      display: flex;
      justify-content: space-between;
      gap: .5rem;
      align-items: center;
    }
    .preview-title {
      font-weight: 600;
      font-size: .85rem;
      line-height: 1.2;
    }
    iframe {
      border: none;
      flex: 1 1 auto;
      background: #000;
      min-height: 380px;
    }
    .preview-meta {
      padding: 0 1.15rem 1rem;
      color: rgba(255,255,255,.5);
      font-size: .68rem;
      display: flex;
      gap: .5rem;
      align-items: center;
      justify-content: space-between;
    }
    .pill-small {
      background: rgba(0,0,0,.4);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 999px;
      padding: .2rem .6rem;
      font-size: .6rem;
    }
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: rgba(255,255,255,.4);
    }
    @media (max-width: 1100px) {
      body { flex-direction: column; }
      .right-pane { width: 100%; min-height: 500px; }
      .grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="font-size:.65rem;letter-spacing:.15em;color:rgba(255,255,255,.25);text-transform:uppercase;">
        CRAFTSMAN+ • PLAY
      </div>
      <h1>Template Catalog <span style="background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.04);padding:.15rem .75rem;border-radius:999px;font-size:.6rem;margin-left:.35rem;vertical-align:middle;">for partners</span></h1>
      <p class="subtitle">Browse core interactive ad templates. Click “Play now” to open live preview. External link opens the created preview URL.</p>
      <p class="subtitle" id="count"></p>
    </header>
    <div id="grid" class="grid">
      <!-- cards injected here -->
    </div>
  </div>

  <aside class="right-pane">
    <div class="preview-header">
      <div>
        <div style="font-size:.55rem;text-transform:uppercase;letter-spacing:.1em;color:rgba(255,255,255,.45);">Preview</div>
        <div class="preview-title" id="previewTitle">Select a template</div>
      </div>
      <button id="openExternal" class="external-btn" title="Open in new tab" disabled>
        ↗
      </button>
    </div>
    <iframe id="previewFrame" src="about:blank" title="Template preview"></iframe>
    <div class="preview-meta">
      <span id="previewGenre" class="pill-small">—</span>
      <span id="previewMode" class="pill-small">Endpoint</span>
    </div>
  </aside>

  <script>
    // path to your JSON in the repo root
    const JSON_URL = 'Playable_Endpoint_URLs.json';
    const THUMB_BASE = 'thumbnails/'; // where your images are now

    const grid = document.getElementById('grid');
    const countEl = document.getElementById('count');
    const previewFrame = document.getElementById('previewFrame');
    const previewTitle = document.getElementById('previewTitle');
    const previewGenre = document.getElementById('previewGenre');
    const openExternalBtn = document.getElementById('openExternal');

    let allData = [];

    function createCard(item, index) {
      const card = document.createElement('div');
      card.className = 'card';

      const thumb = document.createElement('div');
      thumb.className = 'thumb';

      // build thumbnail URL
      let thumbFile = item.thumbnail ? item.thumbnail + '.png' : null;
      if (thumbFile) {
        const img = document.createElement('img');
        img.src = THUMB_BASE + thumbFile;
        img.alt = item.Title || 'Template';
        img.onerror = () => {
          thumb.textContent = 'No preview';
        };
        thumb.appendChild(img);
      } else {
        thumb.textContent = 'No preview';
      }

      const body = document.createElement('div');
      body.className = 'card-body';

      const titleRow = document.createElement('div');
      titleRow.className = 'title-row';

      const title = document.createElement('div');
      title.className = 'card-title';
      title.textContent = item.Title && item.Title.trim() !== '' ? item.Title : 'Untitled template';

      const external = document.createElement('button');
      external.className = 'external-btn';
      external.innerHTML = '↗';
      external.title = 'Open standard preview link';
      external.onclick = (e) => {
        e.stopPropagation();
        const externalUrl = item.URL || item['Endpoint URL'];
        if (externalUrl) window.open(externalUrl, '_blank');
      };

      titleRow.appendChild(title);
      titleRow.appendChild(external);

      const genre = document.createElement('div');
      genre.className = 'genre-pill';
      genre.textContent = item.Genre ? item.Genre : 'Other';

      const playRow = document.createElement('div');
      playRow.className = 'play-row';

      const playBtn = document.createElement('button');
      playBtn.className = 'play-btn';
      playBtn.textContent = '▶ Play now';

      const endpointUrl = item['Endpoint URL'];
      playBtn.disabled = !endpointUrl;

      playBtn.onclick = (e) => {
        e.stopPropagation();
        loadPreview(item);
      };

      const typeLabel = document.createElement('div');
      typeLabel.style.fontSize = '.6rem';
      typeLabel.style.color = 'rgba(255,255,255,.35)';
      typeLabel.textContent = item.Genre ? item.Genre : 'Other';

      playRow.appendChild(playBtn);
      playRow.appendChild(typeLabel);

      body.appendChild(titleRow);
      body.appendChild(genre);
      body.appendChild(playRow);

      card.appendChild(thumb);
      card.appendChild(body);

      // clicking the whole card also loads preview
      card.onclick = () => loadPreview(item);

      return card;
    }

    function loadPreview(item) {
      const endpoint = item['Endpoint URL'];
      const externalUrl = item.URL;

      if (endpoint) {
        previewFrame.src = endpoint;
      } else {
        previewFrame.src = 'about:blank';
      }

      previewTitle.textContent = item.Title && item.Title.trim() !== '' ? item.Title : 'Untitled template';
      previewGenre.textContent = item.Genre ? item.Genre : 'Other';

      if (externalUrl) {
        openExternalBtn.disabled = false;
        openExternalBtn.onclick = () => window.open(externalUrl, '_blank');
      } else if (endpoint) {
        // fallback to endpoint if no regular URL
        openExternalBtn.disabled = false;
        openExternalBtn.onclick = () => window.open(endpoint, '_blank');
      } else {
        openExternalBtn.disabled = true;
        openExternalBtn.onclick = null;
      }
    }

    async function init() {
      try {
        const res = await fetch(JSON_URL + '?cache=' + Date.now());
        const data = await res.json();
        allData = Array.isArray(data) ? data : [];

        grid.innerHTML = '';
        allData.forEach((item, idx) => {
          const card = createCard(item, idx);
          grid.appendChild(card);
        });

        countEl.textContent = `Loaded ${allData.length} templates.`;

        // auto-load first one if exists
        if (allData.length > 0) {
          loadPreview(allData[0]);
        }
      } catch (err) {
        console.error(err);
        grid.innerHTML = '<div class="empty-state">Could not load templates. Make sure <code>Playable_Endpoint_URLs.json</code> is in the repo root.</div>';
      }
    }

    init();
  </script>
</body>
</html>
