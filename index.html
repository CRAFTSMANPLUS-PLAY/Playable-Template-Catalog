<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CRAFTSMAN+ â€¢ PLAY Template Catalog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --page-bg: #0b0e32;
      --card-bg: #ffffff;
      --card-border: rgba(0,0,0,.06);
      --text-main: #0f172a;
      --text-sub: rgba(15,23,42,.55);
      --pill-bg: rgba(255,255,255,.08);
      --pill-border: rgba(255,255,255,.15);
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      background: var(--page-bg);
      font-family: "Poppins", -apple-system, BlinkMacSystemFont, "Inter", Roboto, sans-serif;
      color: #fff;
      min-height: 100vh;
    }
    .wrap {
      max-width: 1280px;
      margin: 0 auto;
      padding: 1.5rem;
    }
    header {
      display: flex;
      gap: 1.25rem;
      align-items: center;
      margin-bottom: 1.75rem;
    }
    .brand-logo {
      height: 48px;
      width: auto;
    }
    h1 {
      margin: 0 0 .35rem;
      font-size: 1.35rem;
      display: flex;
      align-items: center;
      gap: .5rem;
      flex-wrap: wrap;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: .25rem;
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 999px;
      padding: .15rem .55rem .2rem;
      font-size: .65rem;
      font-weight: 500;
    }
    .tagline {
      font-size: .8rem;
      color: rgba(255,255,255,.6);
    }
    .section-title {
      font-size: .7rem;
      text-transform: uppercase;
      letter-spacing: .12em;
      font-weight: 600;
      margin-top: 2rem;
      margin-bottom: 0.75rem;
      color: rgba(255,255,255,.6);
    }
    .genre-block {
      margin-bottom: 1.75rem;
    }
    .genre-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: .75rem;
      gap: .5rem;
    }
    .genre-name {
      font-size: .85rem;
      font-weight: 500;
      color: #fff;
    }
    .genre-count {
      font-size: .65rem;
      color: rgba(255,255,255,.4);
    }
    .grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(4, minmax(0, 1fr));
    }
    @media (max-width: 1100px) {
      .grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
    @media (max-width: 880px) {
      .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 620px) {
      .grid { grid-template-columns: 1fr; }
    }
    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 1rem;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 420px;
      box-shadow: 0 6px 20px rgba(10,10,10,.08);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(10,10,10,.12);
    }
    .card-head {
      padding: .8rem .85rem .5rem;
      border-bottom: 1px solid rgba(15,23,42,.04);
      display: flex;
      gap: .75rem;
    }
    .card-title-block {
      flex: 1;
      min-width: 0;
    }
    .card-title {
      font-size: .8rem;
      font-weight: 600;
      color: var(--text-main);
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .card-sub {
      font-size: .65rem;
      color: var(--text-sub);
    }
    .card-badges {
      margin-top: .45rem;
    }
    .badge-advanced {
      display: inline-flex;
      align-items: center;
      gap: .35rem;
      font-size: .6rem;
      background: rgba(16,185,129,.08);
      color: #047857;
      border: 1px solid rgba(16,185,129,.18);
      padding: .2rem .5rem .25rem;
      border-radius: .5rem;
      font-weight: 500;
    }
    .card-actions {
      display: flex;
      flex-direction: column;
      gap: .35rem;
      align-items: flex-end;
    }
    .icon-btn {
      background: rgba(15,23,42,.05);
      border: none;
      border-radius: .6rem;
      width: 26px;
      height: 26px;
      display: grid;
      place-items: center;
      font-size: .7rem;
      color: rgba(15,23,42,.55);
      cursor: pointer;
      transition: background .15s ease, transform .15s ease;
    }
    .icon-btn:hover {
      background: rgba(15,23,42,.12);
      transform: scale(1.03);
    }
    .thumb-wrap {
      position: relative;
      background: #000;
      /* portrait 2:1 (W:H = 1:2) but we want a *tall* card, so height > width */
      /* We'll force width 100% and height via padding-bottom */
      width: 100%;
      overflow: hidden;
    }
    /* This gives a 2:1 tall aspect (H = 2 * W) */
    .thumb-inner {
      position: relative;
      width: 100%;
      padding-bottom: 200%; /* 2:1 portrait */
      background: #000;
      overflow: hidden;
    }
    .thumb-img,
    .play-iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
      object-fit: cover;
    }
    .thumb-img {
      background: #020617;
      display: block;
    }
    .play-overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: linear-gradient(180deg, rgba(0,0,0,0.15) 0%, rgba(0,0,0,.75) 100%);
      opacity: 1;
      transition: opacity .2s ease;
      cursor: pointer;
    }
    .play-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .play-button {
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,.35);
      border-radius: 999px;
      padding: .45rem .95rem .5rem;
      display: inline-flex;
      align-items: center;
      gap: .35rem;
      font-size: .7rem;
      color: #fff;
      font-weight: 500;
      backdrop-filter: blur(6px);
    }
    .card-footer {
      padding: .55rem .85rem .7rem;
      border-top: 1px solid rgba(15,23,42,.04);
      display: flex;
      gap: .75rem;
      align-items: center;
      justify-content: space-between;
    }
    .endpoint {
      font-size: .55rem;
      color: rgba(15,23,42,.35);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;
      min-width: 0;
    }
    footer {
      text-align: center;
      font-size: .65rem;
      color: rgba(255,255,255,.35);
      margin: 3rem 0 1.5rem;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <!-- your logo in repo -->
      <img src="craftsmanplay-light.png" alt="CRAFTSMAN+ Logo" class="brand-logo" />
      <div>
        <h1>
          <span>CRAFTSMAN+ PLAY</span>
          <span class="pill">Template Catalog</span>
          <span class="pill">For Partners</span>
        </h1>
        <div class="tagline">
          Browse core interactive ad formats. Click "Play Now" to load the live unit. External link opens full preview.
        </div>
      </div>
    </header>

    <div id="app-status" style="font-size:.7rem;color:rgba(255,255,255,.4);margin-bottom:.75rem;">
      Loading templates...
    </div>

    <div id="playables-section"></div>
    <div id="banners-section"></div>

    <footer>
      CRAFTSMAN+ PLAY snapshot. Thumbnails must match file names in JSON. Some endpoints may block iframes.
    </footer>
  </div>

  <script>
    // 1. JSON file candidates (we try them in order)
    const JSON_CANDIDATES = [
      "Playable_Endpoint_URLs_lowercase.json",
      "Playable_Endpoint_URLs.json",
      "Playable_Endpoint_URLs (1).json"
    ];

    const statusEl = document.getElementById("app-status");
    const playablesContainer = document.getElementById("playables-section");
    const bannersContainer = document.getElementById("banners-section");

    // helper: create dom
    function el(tag, attrs = {}, children = []) {
      const node = document.createElement(tag);
      for (const [k,v] of Object.entries(attrs)) {
        if (k === "class") node.className = v;
        else if (k === "style") node.style.cssText = v;
        else node.setAttribute(k, v);
      }
      if (!Array.isArray(children)) children = [children];
      children.forEach(ch => {
        if (typeof ch === "string") node.appendChild(document.createTextNode(ch));
        else if (ch) node.appendChild(ch);
      });
      return node;
    }

    // try each JSON in order
    (async function loadData() {
      let data = null;
      let lastErr = null;
      for (const file of JSON_CANDIDATES) {
        try {
          const res = await fetch(file + "?v=" + Date.now());
          if (!res.ok) throw new Error("HTTP " + res.status);
          data = await res.json();
          statusEl.textContent = "Loaded: " + file;
          break;
        } catch (err) {
          lastErr = err;
        }
      }
      if (!data) {
        statusEl.textContent = "Failed to load JSON (" + (lastErr ? lastErr.message : "unknown") + ")";
        return;
      }
      renderCatalogue(data);
    })();

    function renderCatalogue(items) {
      // normalize items
      const normalized = items.map((row, idx) => {
        // field names guess
        const title = row.title || row.name || row["Template Name"] || "Untitled " + (idx+1);
        const endpointUrl = row.endpointUrl || row["Endpoint URL"] || row["endpoint url"] || "";
        const previewUrl = row.previewUrl || row["Preview URL"] || row["preview url"] || "";
        const genre = row.genre || row.category || row["Category"] || "Other";
        const thumb = row.thumbnail || row["thumbnail"] || row["Thumbnail"] || "";
        const isBanner = !!(row.isBanner || row["is banner"] || row["Animated Banner"] === "Yes" || row["banner"] === "Yes");
        const hasAdvanced = !!(row.hasAdvanced || row["Complex / Advanced Option"] === "Yes" || row["advanced"] === "Yes");

        return {
          title,
          endpointUrl,
          previewUrl,
          genre,
          thumbnail: thumb, // should now be dash + lowercase
          isBanner,
          hasAdvanced
        };
      });

      const playables = normalized.filter(i => !i.isBanner);
      const banners = normalized.filter(i => i.isBanner);

      // group by genre
      const groupBy = (arr) => {
        const out = {};
        arr.forEach(it => {
          const g = it.genre && it.genre.trim() ? it.genre.trim() : "Other";
          if (!out[g]) out[g] = [];
          out[g].push(it);
        });
        return out;
      };

      const playablesByGenre = groupBy(playables);
      const bannersByGenre = groupBy(banners);

      // render playables
      if (playables.length) {
        playablesContainer.appendChild(el("div", {class: "section-title"}, "PLAYABLES"));
        for (const [genre, list] of Object.entries(playablesByGenre)) {
          playablesContainer.appendChild(renderGenreBlock(genre, list));
        }
      }

      // render banners
      if (banners.length) {
        bannersContainer.appendChild(el("div", {class: "section-title"}, "ANIMATED BANNERS"));
        for (const [genre, list] of Object.entries(bannersByGenre)) {
          bannersContainer.appendChild(renderGenreBlock(genre, list));
        }
      }

      statusEl.textContent = "Loaded " + normalized.length + " templates.";
    }

    function renderGenreBlock(genre, list) {
      const block = el("div", {class: "genre-block"});
      const header = el("div", {class: "genre-header"}, [
        el("div", {class: "genre-name"}, genre),
        el("div", {class: "genre-count"}, list.length + " demos")
      ]);
      block.appendChild(header);

      const grid = el("div", {class: "grid"});
      list.forEach(item => {
        grid.appendChild(renderCard(item));
      });
      block.appendChild(grid);

      return block;
    }

    function renderCard(item) {
      const card = el("div", {class: "card"});

      // HEAD
      const actions = el("div", {class: "card-actions"}, [
        // open raw endpoint in new tab
        (() => {
          const b = el("button", {class: "icon-btn", title: "Open endpoint"}, "â†—");
          b.addEventListener("click", (e) => {
            e.stopPropagation();
            if (item.endpointUrl) window.open(item.endpointUrl, "_blank");
          });
          return b;
        })(),
        // reset
        (() => {
          const b = el("button", {class: "icon-btn", title: "Reset playable"}, "ðŸ”„");
          b.addEventListener("click", (e) => {
            e.stopPropagation();
            resetIframe(card);
          });
          return b;
        })(),
        // open preview
        (() => {
          const b = el("button", {class: "icon-btn", title: "Open PLAY preview"}, "â›¶");
          b.addEventListener("click", (e) => {
            e.stopPropagation();
            const target = item.previewUrl && item.previewUrl.trim() ? item.previewUrl : item.endpointUrl;
            if (target) window.open(target, "_blank");
          });
          return b;
        })(),
      ]);

      const head = el("div", {class: "card-head"}, [
        el("div", {class: "card-title-block"}, [
          el("div", {class: "card-title"}, item.title),
          el("div", {class: "card-sub"}, item.genre || "Other"),
          item.hasAdvanced
            ? el("div", {class: "card-badges"}, [
                el("span", {class: "badge-advanced"}, ["âœ”", "Advanced Options / Variants Available"])
              ])
            : null
        ]),
        actions
      ]);

      // THUMB / PLAY
      const thumbWrap = el("div", {class: "thumb-wrap"});
      const thumbInner = el("div", {class: "thumb-inner"});
      const img = el("img", {
        class: "thumb-img",
        src: item.thumbnail ? item.thumbnail : "fallback.png",
        alt: item.title
      });

      const overlay = el("div", {class: "play-overlay"}, [
        el("div", {class: "play-button"}, ["â–¶ï¸Ž Play now"])
      ]);

      const iframe = el("iframe", {
        class: "play-iframe",
        src: "",
        loading: "lazy",
        allow: "accelerometer; autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
      });

      // click to play
      overlay.addEventListener("click", () => {
        if (item.endpointUrl && item.endpointUrl.trim()) {
          iframe.src = item.endpointUrl.trim();
          overlay.classList.add("hidden");
        }
      });

      thumbInner.appendChild(img);
      thumbInner.appendChild(iframe);
      thumbInner.appendChild(overlay);
      thumbWrap.appendChild(thumbInner);

      // FOOTER
      const footer = el("div", {class: "card-footer"}, [
        el("div", {class: "endpoint"}, item.endpointUrl || "â€”"),
      ]);

      card.appendChild(head);
      card.appendChild(thumbWrap);
      card.appendChild(footer);

      // attach refs to card so reset can find it
      card.__iframe = iframe;
      card.__overlay = overlay;
      card.__item = item;

      return card;
    }

    function resetIframe(card) {
      if (!card || !card.__iframe || !card.__overlay || !card.__item) return;
      // clear src
      card.__iframe.src = "";
      // show overlay again
      card.__overlay.classList.remove("hidden");
    }
  </script>
</body>
</html>
