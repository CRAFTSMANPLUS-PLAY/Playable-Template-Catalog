<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CRAFTSMAN+ â€¢ PLAY Catalogue</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0f0f10;
      --card-bg: #ffffff;
      --card-border: rgba(0,0,0,.05);
      --muted: rgba(255,255,255,.4);
      --thumb-bg: #f1f1f1;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Poppins", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: #fff;
    }
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(20px);
      background: rgba(15,15,16,.7);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem 1.25rem;
      display: flex;
      gap: 1rem;
      justify-content: space-between;
      align-items: center;
    }
    .brand {
      display: flex;
      gap: .75rem;
      align-items: center;
    }
    .brand-badge {
      width: 42px;
      height: 42px;
      border-radius: 1.25rem;
      background: #fff;
      color: #000;
      font-size: .6rem;
      font-weight: 600;
      display: grid;
      place-items: center;
    }
    .brand-meta small {
      display: block;
      font-size: .55rem;
      color: rgba(255,255,255,.5);
    }
    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.75rem 1.25rem 3.5rem;
    }
    .section-title {
      font-size: .8rem;
      font-weight: 600;
      margin-bottom: .75rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .genre-block {
      margin-bottom: 2.25rem;
    }
    .genre-head {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: .75rem;
    }
    .genre-title {
      font-size: .7rem;
      font-weight: 600;
    }
    .genre-count {
      font-size: .55rem;
      color: rgba(255,255,255,.35);
    }
    .grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 1.25rem;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 290px;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 16px 35px rgba(0,0,0,.06);
    }
    .card-top {
      padding: .75rem .9rem .35rem;
      border-bottom: 1px solid rgba(0,0,0,.03);
      display: flex;
      justify-content: space-between;
      gap: .5rem;
    }
    .card-title {
      font-size: .7rem;
      font-weight: 600;
      color: #000;
      line-height: 1.15;
    }
    .card-genre {
      font-size: .55rem;
      color: rgba(0,0,0,.5);
    }
    .card-tools button {
      background: transparent;
      border: none;
      padding: .3rem;
      border-radius: .5rem;
      cursor: pointer;
      transition: background .1s ease;
    }
    .card-tools button:hover {
      background: rgba(0,0,0,.05);
    }
    .thumb-wrap {
      background: #fff;
      width: 100%;
      aspect-ratio: 4/3;
      display: grid;
      place-items: center;
      position: relative;
    }
    .thumb-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      background: #fff;
    }
    .thumb-placeholder {
      width: 100%;
      height: 100%;
      background: #dde1e9;
      display: grid;
      place-items: center;
      color: rgba(0,0,0,.3);
      font-size: .6rem;
      text-align: center;
      padding: .5rem;
    }
    .play-btn {
      position: absolute;
      bottom: .5rem;
      right: .5rem;
      background: rgba(0,0,0,.65);
      color: #fff;
      border: 1px solid rgba(255,255,255,.25);
      font-size: .55rem;
      padding: .35rem .55rem;
      border-radius: .4rem;
      cursor: pointer;
    }
    .iframe-wrap {
      width: 100%;
      aspect-ratio: 4/3;
      background: #000;
      position: relative;
    }
    .iframe-wrap iframe {
      width: 100%;
      height: 100%;
      border: 0;
      border-radius: 0;
    }
    .close-iframe {
      position: absolute;
      top: .4rem;
      right: .4rem;
      background: rgba(0,0,0,.35);
      color: #fff;
      border: none;
      font-size: .55rem;
      padding: .25rem .45rem;
      border-radius: .4rem;
      cursor: pointer;
    }
    .adv-badge {
      background: rgba(16,185,129,.12);
      color: #047857;
      border: 1px solid rgba(16,185,129,.2);
      border-radius: .35rem;
      font-size: .5rem;
      padding: .25rem .35rem;
      margin-top: .45rem;
      display: inline-flex;
      gap: .25rem;
      align-items: center;
    }
    .endpoint-bar {
      border-top: 1px solid rgba(0,0,0,.03);
      background: rgba(0,0,0,.02);
      padding: .45rem .75rem;
      font-size: .5rem;
      color: rgba(0,0,0,.35);
      text-overflow: ellipsis;
      white-space: nowrap;
      overflow: hidden;
    }
    footer {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1.25rem 1.5rem;
      font-size: .55rem;
      color: rgba(255,255,255,.35);
    }
    @media (min-width: 1100px) {
      .grid {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="brand">
        <div class="brand-badge">CMP</div>
        <div class="brand-meta">
          <strong style="font-size:.7rem;">CRAFTSMAN+ PLAY Catalogue</strong>
          <small>Interactive Ad Concepts & Variants</small>
          <small>Powered by CRAFTSMAN+ PLAY</small>
        </div>
      </div>
      <div style="text-align:right;">
        <div style="font-size:.55rem;color:rgba(255,255,255,.4);">Read-only snapshot</div>
        <div style="font-size:.55rem;color:rgba(255,255,255,.4);">No login required</div>
      </div>
    </div>
  </header>

  <main id="app">
    <!-- JS will render here -->
  </main>

  <footer>
    CRAFTSMAN+ PLAY snapshot. Some internal or restricted endpoints may not iframe in GitHub Pages.
  </footer>

  <script>
    // ---- CONFIG ----
    // assuming your JSON is committed at the root as this file name:
    const DATA_URL = "Playable_Endpoint_URLs.json";
    const IMAGE_BASE = "./"; // images are in same folder as index.html

    // turn "Character Builder" -> "character-builder.png"
    function titleToThumb(title) {
      if (!title) return null;
      return title
        .toLowerCase()
        .replace(/&/g, "and")
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/^-+|-+$/g, "") + ".png";
    }

    function groupBy(arr, fn) {
      return arr.reduce((acc, item) => {
        const key = fn(item);
        acc[key] = acc[key] || [];
        acc[key].push(item);
        return acc;
      }, {});
    }

    function createCard(item, idx) {
      const card = document.createElement("div");
      card.className = "card";

      const top = document.createElement("div");
      top.className = "card-top";

      const left = document.createElement("div");
      const title = document.createElement("div");
      title.className = "card-title";
      title.textContent = item.title || "Untitled";

      const genre = document.createElement("div");
      genre.className = "card-genre";
      genre.textContent = item.genre || "other";

      left.appendChild(title);
      left.appendChild(genre);

      if (item.hasAdvanced) {
        const adv = document.createElement("div");
        adv.className = "adv-badge";
        adv.innerHTML = "<span>âœ”</span><span>Advanced Options / Variants Available</span>";
        left.appendChild(adv);
      }

      const tools = document.createElement("div");
      tools.className = "card-tools";

      const openRaw = document.createElement("button");
      openRaw.title = "Open raw endpoint";
      openRaw.textContent = "â†—";
      openRaw.onclick = () => {
        if (item.endpointUrl) window.open(item.endpointUrl, "_blank");
      };

      const resetBtn = document.createElement("button");
      resetBtn.title = "Reset / Reload";
      resetBtn.textContent = "ðŸ”„";
      // reset works only when iframe is active â€” weâ€™ll attach later
      resetBtn.dataset.cardId = "card-" + idx;

      const openPreview = document.createElement("button");
      openPreview.title = "Open PLAY preview";
      openPreview.textContent = "â›¶";
      openPreview.onclick = () => {
        const target = item.previewUrl || item.endpointUrl;
        if (target) window.open(target, "_blank");
      };

      tools.appendChild(openRaw);
      tools.appendChild(resetBtn);
      tools.appendChild(openPreview);

      top.appendChild(left);
      top.appendChild(tools);
      card.appendChild(top);

      // PREVIEW AREA (starts as image / placeholder)
      const preview = document.createElement("div");
      preview.className = "thumb-wrap";
      preview.id = "preview-" + idx;

      const imgName = item.thumbSrc || titleToThumb(item.title);
      const img = document.createElement("img");
      img.alt = item.title || "Preview";

      // we attempt to load the thumb; if it fails, show placeholder
      img.src = IMAGE_BASE + imgName;
      img.onerror = () => {
        preview.removeChild(img);
        const ph = document.createElement("div");
        ph.className = "thumb-placeholder";
        ph.innerHTML = "<div style='font-weight:600;margin-bottom:.25rem;'>No preview</div><div style='font-size:.55rem'>" + (item.title || "Playable") + "</div>";
        preview.appendChild(ph);
      };
      preview.appendChild(img);

      const playBtn = document.createElement("button");
      playBtn.className = "play-btn";
      playBtn.textContent = "PLAY NOW";
      playBtn.onclick = () => activateIframe(idx, item, resetBtn);
      preview.appendChild(playBtn);

      card.appendChild(preview);

      const endpointBar = document.createElement("div");
      endpointBar.className = "endpoint-bar";
      endpointBar.textContent = item.endpointUrl || "";
      card.appendChild(endpointBar);

      return card;
    }

    function activateIframe(idx, item, resetBtnEl) {
      const preview = document.getElementById("preview-" + idx);
      if (!preview) return;
      preview.innerHTML = "";
      const wrap = document.createElement("div");
      wrap.className = "iframe-wrap";

      const iframe = document.createElement("iframe");
      iframe.src = item.endpointUrl;
      iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture;";
      iframe.loading = "lazy";

      const closeBtn = document.createElement("button");
      closeBtn.className = "close-iframe";
      closeBtn.textContent = "âœ•";
      closeBtn.onclick = () => {
        // go back to image state
        const card = preview.parentElement;
        const title = item.title || "Playable";
        const imgName = item.thumbSrc || titleToThumb(item.title);
        preview.innerHTML = "";
        const img = document.createElement("img");
        img.alt = title;
        img.src = IMAGE_BASE + imgName;
        img.onerror = () => {
          preview.removeChild(img);
          const ph = document.createElement("div");
          ph.className = "thumb-placeholder";
          ph.innerHTML = "<div style='font-weight:600;margin-bottom:.25rem;'>No preview</div><div style='font-size:.55rem'>" + title + "</div>";
          preview.appendChild(ph);
        };
        preview.appendChild(img);

        const playBtn = document.createElement("button");
        playBtn.className = "play-btn";
        playBtn.textContent = "PLAY NOW";
        playBtn.onclick = () => activateIframe(idx, item, resetBtnEl);
        preview.appendChild(playBtn);
      };

      wrap.appendChild(iframe);
      wrap.appendChild(closeBtn);
      preview.appendChild(wrap);

      // wire the reset button for this iframe
      resetBtnEl.onclick = () => {
        iframe.src = iframe.src;
      };
    }

    function render(data) {
      const app = document.getElementById("app");
      app.innerHTML = "";

      const playables = data.filter(d => !d.isBanner);
      const banners = data.filter(d => d.isBanner);

      // PLAYABLES
      if (playables.length) {
        const sec = document.createElement("section");
        const h = document.createElement("div");
        h.className = "section-title";
        h.innerHTML = "<span>PLAYABLES</span><span style='font-size:.6rem;color:rgba(255,255,255,.35)'>"+playables.length+" items</span>";
        sec.appendChild(h);

        const byGenre = groupBy(playables, it => (it.genre || "other").toLowerCase());
        Object.keys(byGenre).sort().forEach((g) => {
          const block = document.createElement("div");
          block.className = "genre-block";
          const head = document.createElement("div");
          head.className = "genre-head";
          head.innerHTML = "<div class='genre-title'>" + g + "</div><div class='genre-count'>" + byGenre[g].length + " demos</div>";
          block.appendChild(head);

          const grid = document.createElement("div");
          grid.className = "grid";
          byGenre[g].forEach((item, idx) => {
            grid.appendChild(createCard(item, "p-" + g + "-" + idx));
          });
          block.appendChild(grid);
          sec.appendChild(block);
        });

        app.appendChild(sec);
      }

      // BANNERS
      if (banners.length) {
        const sec = document.createElement("section");
        const h = document.createElement("div");
        h.className = "section-title";
        h.innerHTML = "<span>ANIMATED BANNERS</span><span style='font-size:.6rem;color:rgba(255,255,255,.35)'>"+banners.length+" items</span>";
        sec.appendChild(h);

        const byGenre = groupBy(banners, it => (it.genre || "other").toLowerCase());
        Object.keys(byGenre).sort().forEach((g) => {
          const block = document.createElement("div");
          block.className = "genre-block";
          const head = document.createElement("div");
          head.className = "genre-head";
          head.innerHTML = "<div class='genre-title'>" + g + "</div><div class='genre-count'>" + byGenre[g].length + " demos</div>";
          block.appendChild(head);

          const grid = document.createElement("div");
          grid.className = "grid";
          byGenre[g].forEach((item, idx) => {
            grid.appendChild(createCard(item, "b-" + g + "-" + idx));
          });
          block.appendChild(grid);
          sec.appendChild(block);
        });

        app.appendChild(sec);
      }
    }

    // load JSON + render
    fetch(DATA_URL)
      .then((res) => res.json())
      .then((json) => {
        // expect it to be an array of items like the big one you pasted earlier
        render(json);
      })
      .catch((err) => {
        console.error("Failed to load JSON, using empty list.", err);
        render([]);
      });
  </script>
</body>
</html>
